## 修改需求

### 需求：内容渲染与就地编辑
系统必须对 Markdown 文件默认以渲染视图展示，并支持语义就地编辑。

#### 场景：默认以渲染视图打开 Markdown
- **当** 用户打开 `.md` 文件
- **那么** 内容区默认展示为渲染视图，而不是直接进入全量编辑器

#### 场景：双击语义单元进行编辑
- **当** 用户在渲染视图中双击一段内容
- **那么** 系统选中对应语义单元并进入就地编辑

#### 场景：必要时显示 Markdown 语法符号
- **当** 用户进行就地编辑且需要避免结构被破坏
- **那么** 系统仅在必要范围内显示相关 Markdown 语法符号（例如光标所在行）

### 需求：语义双击选区
系统必须将双击行为提升为“语义单元选区”，而不是仅按字符/单词选中。

#### 场景：双击选中链接文本
- **当** 用户双击一个链接的可见文本
- **那么** 系统选中“链接文本”作为一个语义单元，而不是选中包含括号语法的整段源码

#### 场景：双击选中强调文本
- **当** 用户双击加粗/斜体等强调文本
- **那么** 系统优先选中强调范围内的“可见文本”，并在必要时显示对应语法符号以允许修改

### 需求：必要时显示语法（最小暴露）
系统必须默认弱化或隐藏 Markdown 语法符号，并在必要时显示，以支撑准确编辑。

#### 场景：光标进入行内编辑
- **当** 用户进入某一行进行就地编辑
- **那么** 系统在必要范围显示该行相关语法符号以避免破坏结构

#### 场景：退出编辑后恢复渲染观感
- **当** 用户结束就地编辑并离开该行
- **那么** 系统恢复渲染观感（语法符号不再占据可见视觉层）

### 需求：最小改动面保存与风格保持
系统必须以“最小改动面”写回文件，并尽量保持原文件的字节风格（如 BOM、换行风格）。

#### 场景：只修改一个语义单元
- **当** 用户仅修改一小段语义单元内容
- **那么** 系统只写回必要的文本改动，不对未触及区域做全局格式化重排

#### 场景：保存保持 BOM 与换行风格
- **当** 用户保存文件
- **那么** 系统保持该文件的 BOM、换行风格与编码设置不被意外改变

### 需求：撤销与重做
系统必须支持对就地编辑的撤销/重做，以匹配编辑器习惯。

#### 场景：撤销最近一次编辑
- **当** 用户撤销最近一次就地编辑
- **那么** 内容回退到上一个状态，且渲染视图与实际文本保持一致

#### 场景：使用常见快捷键撤销与重做
- **当** 用户按下 `Ctrl+Z`
- **那么** 系统执行撤销
- **当** 用户按下 `Ctrl+Y` 或 `Ctrl+Shift+Z`
- **那么** 系统执行重做

### 需求：兜底源码编辑
系统必须在语义定位失败或结构复杂时提供兜底的源码编辑路径，但不应成为默认体验。

#### 场景：语义定位失败
- **当** 系统无法将某次双击定位到可安全编辑的语义单元
- **那么** 系统提供兜底方式编辑对应源码片段，并明确该方式为降级路径

### 需求：渲染视图行号
系统必须在 Markdown 的渲染视图中提供可选的行号展示，以便用户能将屏幕内容与源文本行号对齐定位。

#### 场景：开启行号显示
- **当** 用户在渲染视图中开启“显示行号”
- **那么** 内容区应展示与源文本一致的行号，并随滚动保持对齐

#### 场景：行号不影响编辑
- **当** 用户进行语义就地编辑或文本选择
- **那么** 行号不应抢占焦点、不应影响选区与复制行为

#### 场景：行号与折行的对齐策略
- **当** 某一源文本行在渲染视图中发生折行（视觉上变成多行）
- **那么** 系统按“源文本行”为单位显示行号，并确保该行号与该源行的首个视觉行对齐

#### 场景：行号只对渲染视图生效
- **当** 用户进入就地编辑或降级到行/块/源码编辑
- **那么** 行号可以保持显示，但不得影响编辑器的布局与输入体验

### 需求：tasks.md 同源编辑
系统必须将 tasks.md 的任务看板视图与源 Markdown 同源，并允许在看板/渲染视图中进行最小改动面的编辑。

#### 场景：打开 tasks.md
- **当** 用户打开 `tasks.md`
- **那么** 默认展示任务看板，并支持勾选与编辑任务内容

#### 场景：看板操作写回源 Markdown
- **当** 用户在看板中勾选或编辑任务项
- **那么** 系统以最小改动面写回 `tasks.md` 原文，并保持保存风格一致

#### 场景：看板与渲染视图保持一致
- **当** 用户在任务看板修改任务项
- **那么** 渲染视图（或打开的任务内容）应反映同一份源文本结果，不出现分叉
