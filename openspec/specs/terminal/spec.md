# terminal Specification

## Purpose
TBD - created by archiving change add-terminal-theme-sync. Update Purpose after archive.
## 需求
### 需求：终端皮肤与 Windows Terminal 同步
系统必须读取 Windows Terminal 的 settings.json，并将配色与字体应用到内置终端。

#### 场景：配置可读取
- **当** 系统发现并成功解析 settings.json
- **那么** 终端主题与字体应与 Windows Terminal 当前配置保持一致

#### 场景：配置不可读取
- **当** settings.json 不存在或解析失败
- **那么** 终端必须回退到内置默认主题与字体

### 需求：终端主题映射规则
系统必须支持将 Windows Terminal color scheme 映射到 xterm 主题字段。

#### 场景：应用配色方案
- **当** color scheme 中提供 foreground/background/cursor/16 色
- **那么** xterm 的 theme 必须使用对应字段

### 需求：字体与字号同步
系统必须同步 Windows Terminal 的字体与字号配置。

#### 场景：配置字体
- **当** settings.json 提供 fontFace/fontSize
- **那么** 终端必须使用相同字体与字号

### 需求：右侧终端提供接近原生 Windows 终端体验
系统必须在右侧面板内嵌终端，支持 ANSI 颜色、光标控制、滚动与复制粘贴。

#### 场景：打开终端并执行命令
- **当** 用户打开右侧终端并输入命令
- **那么** 终端输出的颜色与光标行为应与 Windows Terminal 近似

### 需求：终端右键与剪贴板行为
系统必须支持右键复制/粘贴与常用快捷键，行为接近 Windows Terminal。

#### 场景：右键复制
- **当** 终端存在选区并点击右键
- **那么** 选区内容被复制到剪贴板并清除选区

#### 场景：右键粘贴
- **当** 终端无选区并点击右键
- **那么** 剪贴板内容被粘贴到终端输入

#### 场景：快捷键复制
- **当** 用户按下 Ctrl+Shift+C 或 Ctrl+Insert
- **那么** 选区内容被复制到剪贴板

#### 场景：快捷键粘贴
- **当** 用户按下 Ctrl+V 或 Shift+Insert 或 Ctrl+Shift+V
- **那么** 剪贴板内容被粘贴到终端输入

#### 场景：Ctrl+C 复制
- **当** 用户按下 Ctrl+C 且终端存在选区
- **那么** 选区内容被复制到剪贴板

### 需求：终端必须使用 PTY 驱动 shell
系统必须通过 PTY 与 shell 进程交互，支持输入、输出、resize 与退出事件。

#### 场景：调整终端尺寸
- **当** 用户拖动面板改变宽度
- **那么** 终端 cols/rows 会更新并正确换行

#### 场景：进程退出
- **当** shell 进程退出
- **那么** 终端显示退出状态并允许重启

### 需求：默认 PowerShell，支持 CMD
系统必须默认启动 PowerShell，并支持切换为 CMD。

#### 场景：新增 CMD 会话
- **当** 用户选择 CMD 并新增会话
- **那么** 新会话会使用 CMD 作为 shell

### 需求：终端支持多会话页签
系统必须支持创建多个终端会话并通过页签切换，新增会话默认 PowerShell，且可选择 CMD。

#### 场景：新增 PowerShell 会话
- **当** 用户点击新增会话且未修改默认类型
- **那么** 新会话使用 PowerShell 并显示新页签

#### 场景：新增 CMD 会话
- **当** 用户选择 CMD 并新增会话
- **那么** 新会话使用 CMD 并显示新页签

#### 场景：关闭会话
- **当** 用户关闭某个会话页签
- **那么** 对应进程被销毁且页签移除

### 需求：依赖缺失时降级
系统必须在 node-pty 不可用时给出明确提示，不影响其他功能。

#### 场景：node-pty 未安装
- **当** 终端初始化发现依赖不可用
- **那么** UI 显示错误提示与修复指引

### 需求：终端粘贴图片为文件路径
系统必须在剪贴板包含图片时，将图片保存到当前终端目录的隐藏子目录，并向终端输入图片的绝对路径。

#### 场景：粘贴图片生成路径
- **当** 用户在终端执行粘贴且剪贴板为图片
- **那么** 系统保存 PNG 到隐藏子目录并向终端输入图片绝对路径

### 需求：安全边界
系统必须保持渲染进程无 Node 访问，只能通过预加载桥接终端 API。

#### 场景：渲染进程发送输入
- **当** 用户输入内容
- **那么** 数据只经由桥接 API 传递给主进程

### 需求：终端不依赖外部服务
系统必须在主进程内创建终端实例，不依赖外部 Node 或 nvm。

#### 场景：启动终端
- **当** 用户打开终端面板
- **那么** 终端可直接启动且无需额外服务

### 需求：终端光标与透明度同步
系统必须读取 Windows Terminal 的光标与透明度配置并映射到 xterm 选项。

#### 场景：同步光标样式
- **当** settings.json 提供 cursorShape 或 cursorBlink
- **那么** 终端光标样式与闪烁行为应与配置一致

#### 场景：同步透明度
- **当** settings.json 提供 useAcrylic 或 opacity
- **那么** 终端透明度行为应与配置一致

### 需求：终端字体与粗体规则同步
系统必须同步 Windows Terminal 的字体尺寸与粗体显示规则。

#### 场景：同步字体尺寸
- **当** settings.json 提供 font.size
- **那么** 终端字体大小与 Windows Terminal 实际显示尺寸一致

#### 场景：字号可读性保护
- **当** 同步后的字号过小
- **那么** 终端字体至少提升到可读性阈值

#### 场景：同步粗体规则
- **当** settings.json 的 intenseTextStyle 为 bold
- **那么** 终端使用粗体显示而非亮色替代

